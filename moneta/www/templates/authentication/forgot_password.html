{% extends "base.html" %}
{% load static %}
{% block content %}
    <head>
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script>
            $(function () {
                $("#resetPassword").validate({
                    rules: {
                        email:{
                            required:true,
                            email:true
                        }
                    }
                });

            });
            function changePassword(emails_list) {
                if($('#resetPassword').valid()){
                    console.log(emails_list);
                    let inputs = {};
                    $("#resetPassword").serializeArray().forEach(function (element) {
                        inputs[element.name] = element.value;
                    });
                    user_email = inputs["email"];
                    if (emails_list.includes(user_email)){
                        console.log(user_email);
                        $.ajax(
                            {
                                type: "PUT",
                                url: window.location.href + "changed/",
                                data: inputs,
                                success: function (response) {
                                    console.info(response);
                                },
                                error(error) {
                                    console.error(error);
                                }
                            });
                        $("#successEmail").modal();
                        $("#text-warning").text("");
                        setTimeout(function() {
                            $("#successEmail").modal("hide");
                            location.href = "{% url '/' %}";
                        }, 3000);
                    }
                    else {
                        $("#text-warning").text("User doesn't exist");
                    }}}
        </script>
    <title> Forgot password </title>
    </head>
    <body>
    <div class="container" >
        <div class="col-md-4 col-md-offset-4"  style = "margin: 0 auto;">
            <div style="display: flex;justify-content: center;align-items: center;margin:7px">
                <i class="fa fa-lock fa-4x"></i>
                <div  style="padding: 5px">
                    <p style="margin-bottom: 0px;">Forgot Password?</p>
                    <p style="margin-bottom: 0px;"> You can reset your password here.</p>
                </div>
            </div>
            <form id="resetPassword">
                <div class="form-group">
                    <input  type="email" placeholder="Enter email" class="form-control" name="email" id="resetEmail" >
                </div>                
                <div id="text-warning" class="error"></div>
                <div class="text-center">
                <input  type="button" class="btn btn-primary text-center" onclick="changePassword({{ user_emails }})"  value="Recover">
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="successEmail">
        <div class="modal-dialog">
            <div class="modal-content" style="align-items: center;" >
                    <p>  Check your email, you've got a new password. </p>
            </div>
        </div>
    </div>
    </body>

{% endblock content %}
